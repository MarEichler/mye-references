
```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  dev = "ragg_png"
  )
library(tidyverse)
library(systemfonts)
```


# Fonts  

## ggplot 

Follow along by using the Ubuntu font.  [Download the family Ubuntu family](https://fonts.google.com/specimen/Ubuntu) and extract the zip file.  


<img src="img/fonts-01-extract-fonts.png" alt = "Window of file explorer showing the Ubuntu.zip file" style = "width:49%;">
<img src="img/fonts-02-extracted-fonts.png" alt = "Window of file explorer extracted Ubuntu font files" style = "width:49%;">


### Set-Up R Studio 

Start by setting up your R studio environment by following these instructions: 

- install the [`ragg`](package), the [`systemfonts`](https://github.com/r-lib/systemfonts) will also be installed package as it's a dependency of `ragg`
- Set default graphics device to use AGG in *Tools > Global Options > General > Graphics*
- review available fonts using `systemfonts::system_fonts()`


At this point, all fonts that are installed on your machine are available for use.  


### Convert to .ttf

There are many different types of font files, only .ttf  will work with R & ggplot together. If the custom font you want to use is not a .ttf file, you will need to convert it. 

I used [convertio.co](https://convertio.co/woff-ttf/) website to convert font files to .ttf files. 


### Install Fonts on Machine 

Open a .ttf file. Click 'install' in top right hand corner.  You need to do this for each font file you plan to use. 

<img src="img/fonts-install-on-machine.png" alt = "Window of open .ttf font file, the top right corner is highlighted to show the install button" style = "width:80%;">



Ways to check to see if font has been installed on your machine: 

- Open up Word/PowerPoint/Excel and see if the new font can be used in the document 
- *Control Panel > Appearance and Personalization > Fonts* and search for font in folder 


### View Font Options in R


```{r}
my_fonts <- systemfonts::system_fonts()

ubuntu_fonts <- my_fonts |> 
  filter(family == "Ubuntu") |>
  select(name, family, style, weight, width, italic, monospace)

ubuntu_fonts
```

### Use Fonts in ggplot 


#### Basic Styling (Bold/Italic)


```{r}
#| fig-height: 2
df <- tibble(x = rep(0, 4), y = c(4:1), 
  font = rep("Ubuntu", 4), style = c("plain", "italic", "bold", "bold.italic"))

ggplot(df, aes(x = x, y = y)) +
  labs(title = "Ubuntu Font in ggplot") + 
  geom_text(aes(x = x-0.2, label = style, family = font, fontface = style), hjust = 0) + 
  geom_text(aes(family = font, fontface = style), 
    label = "The quick brown fox jumps over the lazy dog. 1234567890", hjust = 0 ) + 
  scale_y_continuous(limits = c(0.5, 4.5)) + 
  scale_x_continuous(limits = c(-0.2, 0.6)) + 
  theme_void() + theme(plot.title = element_text(family = "Ubuntu", face = "plain"))
```

#### Weight Styling (Medium/Light) 

Many custom fonts will have a light or medium weight version of the font.  In order to use these styles, the user must register these fonts separately.  **This needs to occur every session.**  


```{r}
systemfonts::register_variant(
  name = "Ubuntu Medium",
  family = "Ubuntu",
  weight = "medium"
)
```


All font variants can be hoisted at the same time creating `hoist_fonts()` function.  If you are using the fonts for ggplot2 items within a shiny app, please review [Adding Custom Fonts to a Shiny App](../../shiny-posts/2024-01-08-adding-fonts/adding-fonts.html) 

```{r}

font_hoist <- function(family, silent = FALSE) {

  font_df <- system_fonts()

  # filter to specified font family
  font_varients <- font_df[which(font_df$family == family), c("family", "style", "path")]

  font_specs <- data.frame(
    name = paste(font_varients$family, font_varients$style), # create unique variant name
    plain = font_varients$path # rename to match arguments in register_font fnc
  )

  pwalk(as.list(font_specs), register_font)

  if (!silent)  message(paste0("Hoisted ", nrow(font_specs), " variants:\n",
                               paste(font_specs$name, collapse = "\n")))
}
```



```{r}
#| fig-height: 2

font_hoist("Ubuntu")

df <- tibble(x = rep(0, 4), y = c(4:1), 
  font = c("Ubuntu Light", "Ubuntu", "Ubuntu Medium", "Ubuntu Bold"), 
  style = rep("plain", 4) )

ggplot(df, aes(x = x, y = y)) +
  labs(title = "Ubuntu Font Weights in ggplot") + 
  geom_text(aes(x = x-0.2, label = font, family = font, fontface = style), hjust = 0) + 
  geom_text(aes(family = font, fontface = style), 
    label = "The quick brown fox jumps over the lazy dog. 1234567890", hjust = 0 ) + 
  scale_y_continuous(limits = c(0.5, 4.5)) + 
  scale_x_continuous(limits = c(-0.2, 0.6)) + 
  theme_void() + theme(plot.title = element_text(family = "Ubuntu", face = "plain"))
```

### Export to PNG

```{r}
gg <- ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point() + 
  facet_wrap(~class) + 
  labs(
    title = "a quick brown fox jumps over the lazy dog",
    subtitle = "a quick brown fox jumps over the lazy dog",
    caption = "a quick brown fox jumps over the lazy dog"
  ) +
  theme_minimal(base_family = "Ubuntu") + 
  theme(
    plot.title = element_text(family = "Ubuntu Bold"),
    plot.subtitle = element_text(family = "Ubuntu Medium"),
    plot.caption = element_text(family = "Ubuntu Light")
  )

ggsave(
  plot = gg,
  filename = file.path("img/fonts-export-01.png"),
  dpi = 300,
  height = 6,
  width = 10,
  units = "in",
  bg = "transparent"
)
```
<img src="img/fonts-export-01.png" alt = "ggplot test of Ubuntu fonts for png" style = "width:90%;">

### Export to PDF 

Hoisting fonts (as listed above) works for displaying preview window and exporting to png files; however this will not work if saving image as pdf.  




```{r}
ggsave(
  plot = gg,
  filename = file.path("img/fonts-export-02.pdf"),
  device = cairo_pdf,
  dpi = 300,
  height = 6,
  width = 10,
  units = "in",
  bg = "transparent"
)
```

<object class = "pdf" data="img/fonts-export-02.pdf" width="100%" height="475"></object>

<br>


If you are interested in just bolding items, that can be done and work in pdf without extra steps: 


```{r}
gg <- gg + theme(plot.title = element_text(family = "Ubuntu", face = "bold"))

ggsave(
  plot = gg,
  filename = file.path("img/fonts-export-03.pdf"),
  device = cairo_pdf,
  dpi = 300,
  height = 6,
  width = 10,
  units = "in",
  bg = "transparent"
)
```

<object class = "pdf" data="img/fonts-export-03.pdf" width="100%" height="475"></object>

<br> 

If you want to use other weights (medium or light), or if you wanted to use a bolded italic font -- it can be done but it is a bit of a process. 

##### Step 1: Create Custom Font 

The most important point of this step is changing the name of the font so it is not associated with the original family.  

- [SuperUser, How do you change a TTF font name](https://superuser.com/questions/120593/how-do-you-change-a-ttf-font-name)
- [Glyphr Studio](https://www.glyphrstudio.com/app)


I went to Glphyr Studio and uploaded `Ubuntu-MediumItalic.ttf` by clicking the 'Load' tab. Uploading takes a 1-2 minutes. 

<img src="img/fonts-pdf-01A.png" alt = "home page of glphyr studio app, select 2nd tab that says load" style = "width:49%;">
<img src="img/fonts-pdf-01B.png" alt = "loading page of glphyr studio as characters from font are loading" style = "width:49%;">

Once the font is uploaded, change the name of the font by clicking the **Edit project and font info**.  Select the 'Font' tab and change the name, in this case to "UbuntuMediumItalic." 

<img src="img/fonts-pdf-02A.png" alt = "glphyr studio landing page after font has been imported, shows button to edit project and font info" style = "width:49%;">
<img src="img/fonts-pdf-02B.png" alt = "edit font name box shown in the font section" style = "width:49%;">

Finally, select file and export the otf file.  

<img src="img/fonts-pdf-03A.png" alt = "shows export to otf optioin from the file menu" style = "width:49%;">
<img src="img/fonts-pdf-03B.png" alt = "custom otf file in the downloads folder" style = "width:49%;">


##### Step 2: Install font 

Open the otf file and click the install button.  After this is complete, the 'new' font should show up in the Fonts on the control panel. 

<img src="img/fonts-pdf-04.png" alt = "Fonts have both Ubuntu with multiple styles and the custom font UbuntuMediumItalic" style = "width:75%;">


After restarting the R environment, the custom font should also be displayed in the system fonts.  

```{r}
systemfonts::system_fonts() |> 
  filter(str_detect(name, "Ubuntu")) |> 
  arrange(family, name) |> 
  select(name, family, style, weight, width, italic, monospace)
```

##### Step 3: Use Custom Font Name 

The fonts will NOT work in the ggplot preview or when saving as png -- only in saved pdf files. 

```{r}
gg <- ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point() + 
  facet_wrap(~class) + 
  labs(
    title = "a quick brown fox jumps over the lazy dog",
    subtitle = "a quick brown fox jumps over the lazy dog",
    caption = "a quick brown fox jumps over the lazy dog"
  ) +
  theme_minimal(base_family = "Ubuntu") + 
  theme(
    plot.title = element_text(family = "UbuntuMediumItalic"),
    plot.subtitle = element_text(family = "UbuntuMediumItalic"),
    plot.caption = element_text(family = "UbuntuMediumItalic")
  )

gg

ggsave(
  plot = gg,
  filename = "img/fonts-export-D.pdf", 
  device = cairo_pdf,
  dpi = 300,
  height = 6,
  width = 10,
  units = "in",
  bg = "transparent"
)

```


Can't get pdf preview to load when using the custom fonts; below is a screen shot of what the pdf looks like when opened.  

<img src="img/fonts-export-04.png" alt = "screen shot of pdf using custom font" style = "width:90%;">

<!-- <object class = "pdf" data="img/fonts-export-D.pdf" width="100%" height="475"></object>  --> 

### Additional Links

- [Kerning and Kerning in a Widening Gyre, 2025 (fonts in pdf)](https://kieranhealy.org/blog/archives/2025/02/06/kerning-and-kerning-in-a-widening-gyre/)  
- [Setting up and debugging custom fonts, June Choe - 2021](https://yjunechoe.github.io/posts/2021-06-24-setting-up-and-debugging-custom-fonts/)
- [Selecting the correct image file type, 2021](https://www.jumpingrivers.com/blog/knitr-image-png-jpeg-svg-rmarkdown/)



## ttf: extrafont

### Install Packages 


```{r}
#| eval: FALSE 
install.packages("extrafont")
remotes::install_version("Rttf2pt1", version = "1.3.8")
```

As of August 2022, if you just install `{extrafont}` as is, you will have a problem with importing fonts on Windows and there will be an error saying 'No Font Name'.  To solve this, install version 1.3.8 of `{Rttf2pt1}`.  

<div class="source">
Sources: [Stack Overflow, May 2020 | how to resolve the "No Font Name" issue when importing fonts into R with extrafont](https://stackoverflow.com/questions/61204259/how-can-i-resolve-the-no-font-name-issue-when-importing-fonts-into-r-using-ext) and [extrafont GitHub Issue #88 Jul 2021 | wzbillings comment](https://github.com/wch/extrafont/issues/88#issuecomment-890426514)
</div>


### Download All .ttf Fonts in `C:\Windows\Fonts` Folder

```{r}
#| eval: FALSE 
#will import ALL fonts, takes 5-10 min
extrafont::font_import() 
```


### Download Other Fonts by File 

```{r}
#| eval: FALSE 
extrafont::font_import(paths = "C:/PATH/TO/FOLDER/WITH/TTF", prompt = FALSE) 
```

### Use 

Prior to using fonts in R, need to load fonts in each session (this is like using `library()` or `box::use()` for a specific package) 

```{r}
#| eval = FALSE 
#quiet = FALSE to remove listing of of fonts 
extrafont::Loadfonts(devide = "win", quite = TRUE) 
```

## otf: showtext 

### Install Packages 

- issues with `{showtext}` package when in use 
- other ggplot2 fonts are affect when actively using this package, making the fonts smaller and making line breaks much larger

```{r}
#| eval: FALSE 
install.packages("showtext")
library(showtext)
showtext_auto() 
font_add("NewFont", regular = "C://PATH//TO//NewFont.otf")
font_families()
```


```{r}
#| eval: FALSE 
#| echo: FALSE 
showtext_auto() 
font_add("Graphik", regular = "C://Users//meichlersmith//Desktop//Fonts//Graphik.otf")
font_families()
```